@let uploads = (uploads$ | async) ?? [];
@if (uploads.length) {
  <div class="fixed bottom-4 right-4 w-full max-w-sm z-50">
    <div class="bg-gray-800 rounded-lg shadow-2xl flex flex-col">
      <div class="p-4 border-b border-gray-700 flex justify-between items-center">
        <h3 class="text-lg font-semibold text-white">Uploads</h3>
        <button
          (click)="clearFinished()"
          class="text-sm text-gray-400 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="(finishedCount$ | async) === 0"
        >
          Clear Finished
        </button>
      </div>

      <div class="flex">
        <!-- Tabs -->
        <div class="flex flex-col border-b border-gray-700 px-2">
          @for (tab of tabs; track tab.id) {
            @let activeTab = activeTab$ | async;
            @let counts = counts$ | async;
            <button
              (click)="selectTab(tab.id)"
              class="px-3 py-2 text-xs font-medium border-b-2 disabled:opacity-50 {{
                activeTab === tab.id
                  ? getProgressBarClass(tab.id) + ' text-white'
                  : 'text-gray-400 hover:text-white'
              }}"
              [disabled]="counts?.[tab.id] === 0"
            >
              {{ tab.label }}
              <span class="bg-gray-700 rounded-full px-2 py-0.5 text-xs ml-1">
                {{ counts?.[tab.id] || 0 }}
              </span>
            </button>
          }
        </div>

        <!-- List -->
        <div class="flex-1 p-4 space-y-3 max-h-[40vh] overflow-y-auto">
          @for (upload of filteredUploads$ | async; track upload.id) {
            <div class="text-white animate-fade-in">
              <div class="flex justify-between items-center text-sm">
                <p class="truncate pr-2">{{ upload.file.name }}</p>
                @if (upload.status !== 'queued') {
                  <p class="font-mono">{{ upload.progress }}%</p>
                } @else {
                  <p class="font-mono text-gray-400">Queued</p>
                }
              </div>
              <div class="w-full bg-gray-700 rounded-full h-2.5 mt-1">
                <div
                  class="h-2.5 rounded-full transition-all duration-300 ease-linear"
                  [ngClass]="getProgressBarClass(upload.status)"
                  [style.width.%]="upload.progress"
                ></div>
              </div>
              <div class="text-xs mt-1">
                @switch (upload.status) {
                  @case ('duplicate') {
                    <p class="text-orange-500">Duplicate item uploaded.</p>
                  }
                  @case ('error') {
                    <p class="text-red-400">{{ upload.error }}</p>
                  }
                  @case ('success') {
                    <p class="text-green-400">Upload complete.</p>
                  }
                }
              </div>
              <button
                (click)="cancelUpload(upload.id)"
                class="text-xs text-gray-400 hover:text-white mt-1"
              >
                Dismiss
              </button>
            </div>
          } @empty {
            <div class="text-center text-gray-500 py-4">No items in this category.</div>
          }
        </div>
      </div>
    </div>
  </div>
}
